#!/bin/sh
# Define constants
VERSION='2.2.11'
TARBALL_URL='https://raw.githubusercontent.com/xtrasimplicity/sphinx-buildpack/master/prebuilt_binaries.tar.gz'
TARGET_DIR='vendor/sphinx'

# Retrieve arguments
BUILD_DIR=$1
#CACHE_DIR=$2
#ENV_DIR=$3


echo "-----> Installing Sphinx ${VERSION}"

cd $BUILD_DIR
mkdir -p $TARGET_DIR

echo "-------> Retrieving pre-built binaries"
curl $TARBALL_URL -s -o binaries.tar.gz

echo "-------> Deploying pre-built binaries"
tar xfz binaries.tar.gz -C $TARGET_DIR
rm binaries.tar.gz

echo "-------> Updating environment variables"
PROFILE_DIR=".profile.d"

mkdir $PROFILE_DIR
echo 'export PATH="$HOME/vendor/sphinx/bin:$PATH"' > $PROFILE_DIR/sphinx_init.sh
chmod +x $PROFILE_DIR/sphinx_init.sh
